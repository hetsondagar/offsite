# OffSite (Frontend)

A mobile-first React + TypeScript frontend for OffSite ‚Äî a construction site operations app focused on DPRs, attendance, materials, approvals, insights and offline-first synchronization.

---

## üîß Quick start

Requirements: Node.js (16+), pnpm / npm / bun

1. Install dependencies

```bash
npm install
```

2. Run in development

```bash
npm run dev
```

3. Build

```bash
npm run build
```

4. Preview production build

```bash
npm run preview
```

---

## üöÄ Features (high level)

- Mobile-first UI built with React + Vite + TypeScript ‚úÖ
- Tailwind CSS for utility-first styling and theming (dark/light) ‚úÖ
- Component primitives & accessibility using Radix UI and shadcn-style components ‚úÖ
- Role-based access control (RBAC) with three roles: **Site Engineer**, **Project Manager**, **Owner / Admin** ‚úÖ
- Authentication flow (phone ‚Üí OTP ‚Üí role selection) with persisted session (localStorage) ‚úÖ
- PWA-ready: Service Worker registered in `src/main.tsx` + `public/sw.js` cache strategy ‚úÖ
- Offline-first data handling:
  - IndexedDB stores for DPRs, Attendance, and Material Requests (`src/lib/indexeddb.ts`) ‚úÖ
  - Redux offline queue for pending items and synchronization UI (`offlineSlice`) ‚úÖ
  - Manual/automatic synchronization from `Sync` page with status and last sync timestamp ‚úÖ
- DPR (Daily Progress Report) flow: photo upload (placeholder), AI-generated summary (simulated), offline save & sync ‚úÖ
- Attendance flow: GPS location simulation, check in/out, offline save & sync ‚úÖ
- Material requests: anomaly detection (threshold warning), request creation, history & approval flow ‚úÖ
- Approvals: Manager approval / rejection workflow with self-approval protection ‚úÖ
- Insights & analytics: charts (Recharts), delay risk predictor, AI insights & recommendations (mock data) ‚úÖ
- Invoicing: GST-aware invoices, downloads (mock) ‚úÖ
- Toasts & notifications: Sonner + in-app toaster ‚úÖ
- React Query for async state management & future API integration ‚úÖ
- Form handling & validation-ready (react-hook-form + zod available) ‚úÖ

---

## üóÇÔ∏è Notable files & folders

- `src/` ‚Äì main source
  - `src/pages/` ‚Äì feature pages (Login, Signup, Index, DPR, Attendance, Materials, Approvals, Insights, Projects, Invoicing, Sync)
  - `src/components/` ‚Äì UI components and layout (MobileLayout, BottomNav, common UI)
  - `src/lib/indexeddb.ts` ‚Äì IndexedDB helpers for offline data
  - `src/store/` ‚Äì Redux store and slices (`authSlice`, `offlineSlice`)
  - `src/hooks/` ‚Äì app hooks (e.g., `usePermissions`, `useMobile`, `use-toast`)
  - `src/data/dummy.js` ‚Äì example/mock data used across the app
  - `public/sw.js` ‚Äì service worker for caching/offline

---

## ‚úÖ Role capabilities summary

- Site Engineer
  - Create DPRs, mark attendance, raise material requests
  - View own DPRs/attendance/material requests

- Project Manager
  - View dashboards, approve/reject material requests, access AI insights

- Owner / Admin
  - Access global dashboards, invoices, manage projects & users, export reports

---

## üß™ Development notes & TODOs

- AI features are currently simulated (placeholder summary text). Replace with an AI backend or API when available.
- Sync currently simulates server sync in `SyncPage` ‚Äî integrate real API endpoints to persist and mark items as synced.
- Service worker caching strategy is production-safe for Vite builds (app shell + runtime asset caching). If you change static assets, bump the cache name in `public/sw.js`.
- Add unit/integration tests and CI checks (linting is configured with `npm run lint`).

---

## üìö Libraries & tech stack

- Runtime / Bundler: Vite, React 18, TypeScript
- UI: Tailwind CSS, Radix UI primitives, shadcn-style components
- State: Redux Toolkit, React Query
- Offline: idb (IndexedDB wrapper), Service Worker
- Forms & validation: react-hook-form, zod
- Charts: Recharts
- Icons: lucide-react
- Toaster: Sonner

---

## üìù Notes

> This README was generated by analyzing the current codebase. For any missing runtime/back-end pieces, consult the mock data in `src/data/dummy.js` and the synchronization helpers in `src/lib/indexeddb.ts` as the starting integration points.

---

## ‚úÖ Offline / PWA testing (recommended)

Service workers are easiest to validate on a production build.

1. Build and serve the production bundle:

```bash
npm run build
npm run preview -- --host 127.0.0.1 --port 8080
```

2. Open `http://127.0.0.1:8080` in Chrome/Edge.
3. DevTools ‚Üí Application ‚Üí Service Workers: confirm `sw.js` is registered.
4. DevTools ‚Üí Network ‚Üí check **Offline**, then refresh.

Expected behavior:
- The app shell (SPA) still loads offline after at least one successful online visit.
- API data requires connectivity unless it was explicitly stored locally (IndexedDB offline queue + Sync flow).

---

## Project status & Roadmap

### Quick status
- **Frontend features**: Pages & offline patterns implemented for DPR, Attendance, Materials, Sync ‚Äî **Mostly ‚úÖ**
- **Backend integration**: Many features use mock/dummy data and need real API integration ‚Äî **‚ö†Ô∏è**
- **Tests/CICD**: Unit/integration tests and CI not implemented ‚Äî **‚ö†Ô∏è**

### Per-page checklist
- **Login / Signup**
  - [x] UI, flows & session persistence
  - [ ] Add e2e tests (Cypress / Playwright)
- **DPRPage**
  - [x] Photo upload, offline save & sync UI
  - [ ] Integrate with backend DPR API & image uploads
- **AttendancePage**
  - [x] Checkin/checkout with location & offline save
  - [ ] Integrate server-side attendance validation
- **MaterialsPage**
  - [x] Create material requests & history
  - [ ] Wire approvals to real backend flows
- **SyncPage**
  - [x] Manual/auto sync UI, status display
  - [ ] Replace simulated sync with real batch API and error handling
- **Insights / Dashboards**
  - [x] Mock insights, charts & recommendations
  - [ ] Replace mocks with real AI/ML backend outputs

### Roadmap (next priorities)
1. Finalize sync API contract and integrate with backend sync endpoints
2. Add unit/integration tests and CI checks
3. Harden PWA caching & offline durability
4. Add accessibility audits & fixes

---

If you'd like, I can:
- Add a **Contributing** section and development checklist
- Generate a Postman / OpenAPI spec for frontend-backend contract
- Create initial test scaffolding and CI workflow examples


